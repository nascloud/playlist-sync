# 匹配失败原因分析 (第四轮优化后)

## 总体情况

本次测试共处理了 44 首歌曲，匹配成功数为 42，匹配成功率为 95.45%。这比上一轮的 2.27% 有了巨大提升，表明核心标题提取和艺术家评分逻辑的优化非常有效。

从 `test_enhanced_matching.py` 的详细日志输出来看，问题主要集中在以下两首歌曲：

1.  **`冬眠·2023` by `阿YueYue, 刘兆宇`**: 核心标题提取为 `冬眠 2023`，在 Plex 库中搜索返回 0 个结果。这表明库中确实不存在这首歌。
2.  **`你，好不好？` by `Eric周兴哲`**: 核心标题提取为 `你 好不好`，在 Plex 库中搜索返回 0 个结果。这同样表明库中可能不存在这首歌。

值得注意的是，之前一直无法匹配的 `Baby, Don't Cry（人鱼的眼泪） (Chinese Ver.)` 现在已经可以匹配到 `Baby Don't Cry` by `安室奈美恵`，尽管是低置信度匹配 (分数 45)，但这证明了 `_remove_punctuation` 函数的修改是成功的。

## 问题诊断

### 1. 核心标题搜索失败 (`match_score` 为 0)

*   **`冬眠·2023`**: 标准化和核心标题提取逻辑 (包括保留单引号) 工作正常，提取出的核心标题是合理的 (`冬眠 2023`)。搜索失败的原因极有可能是 Plex 音乐库中没有这首歌。
*   **`你，好不好？`**: 同样，核心标题提取为 `你 好不好` 是合理的。搜索失败的原因也极有可能是 Plex 音乐库中没有这首歌。

### 2. 评分不足 (有候选但分数低)

本次测试中，绝大多数匹配成功的歌曲都是低置信度匹配 (分数在 45-55 之间)。这表明当前的评分阈值 (High: 65, Low: 50) 可能需要调整，或者评分逻辑还需要进一步优化。

*   **普遍现象**: 例如 `若月亮没来 (Live)` 得分 50.95，`壁上观` 得分 50.60，`凉凉` 得分 55.30。这些歌曲的艺术家信息在库中并不完全匹配，导致艺术家评分较低，从而影响了最终得分。
*   **原因分析**:
    *   **艺术家评分逻辑**: 尽管艺术家评分逻辑已经优化，但对于多艺术家歌曲，如果库中只存了部分艺术家，或者艺术家名称有细微差异 (如 `杨宗纬` vs `杨坤&张碧晨` 中的 `杨坤`)，最终得分仍然可能不够高。
    *   **阈值**: 当前 Low 阈值 50 对于当前的评分体系来说是合适的，因为它捕获了绝大多数正确匹配。但 High 阈值 65 过高，几乎没有歌曲能达到。

## 优化方案建议

基于以上分析，提出以下优化建议：

1.  **维持核心标题提取逻辑**: 当前的修改 (保留单引号、更健壮的版本关键词移除) 已被证明是有效的，应保持不变。
2.  **微调阈值**:
    *   **问题**: High 阈值 65 过高，导致几乎没有高置信度匹配。
    *   **建议**: 将 `SEARCH_SCORE_THRESHOLD_HIGH` 从 65 调整为 55。这样，像 `凉凉` (55.30) 这样的匹配可以被归类为高置信度。
3.  **进一步分析未匹配歌曲**:
    *   对于 `冬眠·2023` 和 `你，好不好？`，需要人工确认它们是否确实存在于 Plex 音乐库中。如果不存在，则无法匹配是合理的，无需进一步优化策略。
4.  **(可选) 继续优化艺术家评分**:
    *   当前的艺术家评分逻辑已经相当不错。如果希望进一步提高高置信度匹配的数量，可以考虑在 `_calculate_artist_score` 中，对完全匹配或主要艺术家匹配的情况给予更高的基础奖励分。

## 下一步行动

1.  **人工确认未匹配歌曲**: 确认 `冬眠·2023` 和 `你，好不好？` 是否存在于 Plex 音乐库中。
2.  **调整阈值**: 将 `SEARCH_SCORE_THRESHOLD_HIGH` 从 65 调整为 55。
3.  **重新运行测试**: 应用阈值调整后，再次运行 `test_enhanced_matching.py`，生成新的分析文件。
4.  **分析新结果**: 比较新旧分析文件，评估阈值调整的效果，特别是高置信度匹配数量的变化。