# 匹配策略优化分析报告

## 概述

本次分析旨在评估对 Plex 音乐匹配策略进行的一系列优化后的效果。主要优化点包括：

1.  **核心标题提取**: 简化逻辑，仅移除括号内容。
2.  **评分权重**: 降低专辑权重。
3.  **匹配阈值**: 降低高置信度和低置信度匹配的分数阈值。

## 优化措施

### 1. 核心标题提取 (`_extract_core_title`)

**修改内容**:
- 移除了复杂的版本关键词移除逻辑。
- 现在仅通过 `_remove_brackets` 函数移除所有类型的括号内容（如 `()`、`[]`、`（）`、`［］`）。

**目的**:
- 简化标题提取过程，避免因复杂的正则表达式或关键词列表导致的错误。
- 专注于移除可能引起混淆的附加信息（如版本说明、合作艺人等），这些信息通常包含在括号内。

### 2. 评分权重调整

**修改内容**:
- 将专辑权重从 0.25 降低至 0.20。
- 相应地，标题和艺术家的权重分别调整为 0.45 和 0.35。

**目的**:
- 专辑信息在匹配过程中提供的区分度相对较低，尤其当专辑名称不完整或不准确时，过高的权重可能导致误判。
- 降低专辑权重可以使标题和艺术家信息在评分中占据更重要的地位，从而提高匹配的准确性。

### 3. 匹配阈值调整

**修改内容**:
- 将高置信度匹配阈值 (`SEARCH_SCORE_THRESHOLD_HIGH`) 从 65 降低至 60。
- 将低置信度匹配阈值 (`SEARCH_SCORE_THRESHOLD_LOW`) 从 50 降低至 40。

**目的**:
- 原始阈值可能设置得过高，导致许多实际匹配良好的歌曲被判定为不匹配或低置信度匹配。
- 降低阈值可以扩大匹配范围，让更多潜在的正确匹配结果被识别出来。

## 优化效果分析

根据测试脚本的输出结果：

- **匹配成功率**: 从之前的极低水平（约 2.27%）大幅提升至 **93.18%** (41/44)。
- **匹配失败数量**: 从 43 首减少至 **3** 首。
- **低置信度匹配**: 大部分匹配成功的歌曲都被标记为“低置信度匹配”，这表明它们的分数介于新的高低阈值之间（40-60）。这通常是期望的行为，表示匹配结果可能存在不确定性，需要人工审核。
- **未匹配歌曲分析**: 剩余的 3 首未匹配歌曲中，只有 1 首（33.33%）疑似为多艺术家问题。这表明多艺术家处理已不再是主要瓶颈。

**具体案例分析**:

1.  **成功匹配示例 ('爱你 (青春离别版)' by '高睿')**:
    - **最终得分**: 45.0 (低于新的 `HIGH` 阈值 60，因此被标记为低置信度)。
    - **匹配结果**: `爱你` by `动力火车`。
    - **分析**: 标题完全匹配，但由于艺术家信息不匹配（'高睿' vs '动力火车'），导致艺术家得分仅为 0。最终得分主要由标题贡献 (45%)。这属于标题匹配但艺术家不符的典型案例，被正确地识别为低置信度匹配。

2.  **成功匹配示例 ('若月亮没来 (若是月亮还没来)' by '王宇宙Leto, 乔浚丞')**:
    - **最终得分**: 53.05 (介于新的 `LOW` 和 `HIGH` 阈值之间，标记为低置信度)。
    - **匹配结果**: `若月亮没来 (若是月亮还没来)` by `王宇宙Leto`。
    - **分析**: 标题和主要艺术家 `王宇宙Leto` 都匹配良好，因此获得了较高的分数。但由于查询艺术家包含 `乔浚丞` 而匹配结果不包含，导致艺术家得分未达满分，最终得分落在中间区域。

3.  **未匹配示例 ('Baby, Don't Cry（人鱼的眼泪） (Chinese Ver.)' by 'EXO (\uc5d1\uc18c)')**:
    - **核心标题**: `baby don t cry`。
    - **分析**: 核心标题提取成功，但 Plex 库中没有以此为标题的歌曲。这表明库中确实缺少这首歌曲，而非匹配策略问题。

4.  **未匹配示例 ('冬眠·2023' by '阿YueYue, 刘兆宇')**:
    - **核心标题**: `冬眠 2023` (注意：这里的 `·` 被替换成了空格)。
    - **分析**: 核心标题提取后在 Plex 库中找不到匹配项。可能是标题标准化过程中 `·` 被错误处理，或者库中确实没有名为 `冬眠 2023` 的歌曲。

## 结论与建议

### 结论

1.  **显著提升**: 本轮优化非常成功，极大地提高了匹配成功率。
2.  **核心标题提取有效**: 简化的仅移除括号的策略证明是有效的，避免了过度复杂的逻辑带来的潜在问题。
3.  **权重调整合理**: 降低专辑权重有助于提高评分的相关性。
4.  **阈值调整合适**: 新的阈值设置使得大部分歌曲能够获得一个初步的匹配结果，即使是低置信度的，为进一步的人工筛选提供了基础。
5.  **主要问题转变**: 匹配失败的主要原因已从策略缺陷转变为库中确实不存在歌曲或标题提取仍有细微偏差。

### 建议

1.  **处理剩余未匹配项**:
    - 针对 `Baby, Don't Cry...` 和 `冬眠·2023` 等未匹配项，检查 Plex 音乐库是否确实包含这些歌曲。
    - 如果库中存在，需要进一步分析标题提取或搜索过程中的问题。

2.  **考虑动态阈值或后处理**:
    - 当前固定的高低阈值虽然有效，但对于不同类型的匹配（例如标题完全匹配但艺术家完全不同 vs 标题和艺术家都部分匹配），可能需要不同的评判标准。
    - 可以探索更复杂的后处理逻辑，例如根据得分差距、候选数量等因素动态调整最终匹配结果的可信度标签。

3.  **优化日志和调试信息**:
    - 为 `_extract_core_title` 等核心函数增加更详细的调试日志，记录输入输出，方便追踪特定案例的处理流程。

4.  **评估“低置信度”标签的意义**:
    - 检查被标记为“低置信度”的匹配结果，统计其中有多少实际上是正确的匹配。这有助于评估当前阈值划分的合理性，以及“低置信度”标签能否有效帮助用户识别需要重点关注的结果。