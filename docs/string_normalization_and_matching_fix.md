# 字符串标准化和匹配权重优化修复

## 问题描述

在使用智能播放列表功能时，发现某些歌曲无法正确匹配到对应的播放列表中。典型案例如"跳楼机 LBI利比（时柏尘)"无法匹配到任务中的"跳楼机 LBI利比"。

## 问题分析

通过深入分析发现两个主要问题：

1. **字符串标准化不完整**：
   - 原有的字符串标准化函数只处理了英文括号 `()` 和 `[]`
   - 没有处理中文括号 `（）` 和 `［］`
   - 只移除包含特定关键词（feat/ft/remix/edit）的括号内容，对于像"（时柏尘）"这样不包含关键词的括号内容不会被移除

2. **匹配权重不够合理**：
   - 原有权重分配：标题60%，艺术家30%，专辑10%
   - 这种分配可能无法准确反映实际匹配的重要性

## 解决方案

### 1. 字符串标准化改进

修改了以下两个文件中的字符串标准化函数：

- `backend/services/plex_service.py` 中的 `normalize_string` 函数
- `backend/services/auto_playlist_service.py` 中的 `_normalize_string` 方法

具体改进：
```python
# 添加对中英文括号的支持
text = re.sub(r"[（\(](feat|ft|remix|edit)[^)）]*[)）]", "", text)
text = re.sub(r"[［\[]](feat|ft|remix|edit)[^\]］]*[\]］]", "", text)

# 添加移除所有剩余括号内容的规则（不管是否包含关键词）
text = re.sub(r"[（\(][^)）]*[)）]", "", text)
text = re.sub(r"[［\[][^\]］]*[\]］]", "", text)
```

### 2. 匹配权重优化

调整了综合匹配分数的权重分配：

- 原始：标题60%，艺术家30%，专辑10%
- 调整后：标题70%，艺术家25%，专辑5%

## 修复效果

修复后，以下所有情况都能正确匹配：
- 'LBI利比（时柏尘)' vs 'LBI利比' → 'lbi利比' vs 'lbi利比' (完全匹配)
- 'LBI利比 (时柏尘)' vs 'LBI利比' → 'lbi利比' vs 'lbi利比' (完全匹配)
- 'LBI利比(时柏尘)' vs 'LBI利比' → 'lbi利比' vs 'lbi利比' (完全匹配)
- 'LBI利比（feat. 时柏尘）' vs 'LBI利比' → 'lbi利比' vs 'lbi利比' (完全匹配)
- 'LBI利比 [remix]' vs 'LBI利比' → 'lbi利比' vs 'lbi利比' (完全匹配)
- 'LBI利比 remix' vs 'LBI利比' → 'lbi利比' vs 'lbi利比' (完全匹配)

这样，"跳楼机 LBI利比（时柏尘)" 和任务中的 "跳楼机 LBI利比" 就能正确匹配了。

## 测试验证

通过专门的测试脚本验证了修复效果，确保：
1. 修复前的问题案例现在能够正确匹配
2. 不会因为降低标准而产生错误匹配
3. 各种边界情况都能得到正确处理

## 相关文件

- `backend/services/plex_service.py`
- `backend/services/auto_playlist_service.py`